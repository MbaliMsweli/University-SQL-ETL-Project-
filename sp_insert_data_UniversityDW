
----Stored procedure for inserting year 1 data from stagingDB to Datawarehouse
CREATE PROCEDURE Insert_yr1_UniversityDW
AS
BEGIN
INSERT INTO [UniversityDW].[dbo].[DW_Year1Modules] (
	ModuleCode ,
	ModuleName ,
	Credits ,
	Category,
	LoadDate)
SELECT
   S.[ModuleCode],
   S.[ModuleName],
   S.[Credits],
   S.[Category],
   S.[DateInserted]
FROM
    [UniversityStagingDB].[dbo].[Year1Modules] AS S
WHERE NOT EXISTS (
    SELECT 1
    FROM[UniversityDW].[dbo].[DW_Year1Modules] AS DWH
    WHERE DWH.ModuleCode = S.ModuleCode
	);

END

EXEC Insert_yr1_UniversityDW;

----Stored procedure for inserting year 2 data from stagingDB to Datawarehouse


CREATE PROCEDURE Insert_yr2_UniversityDW
AS
BEGIN
INSERT INTO [UniversityDW].[dbo].[DW_Year1Modules] (
	ModuleCode ,
	ModuleName ,
	Credits ,
	Category,
	LoadDate)
SELECT
   S.[ModuleCode],
   S.[ModuleName],
   S.[Credits],
   S.[Category],
   S.[DateInserted]
FROM
    [UniversityStagingDB].[dbo].[Year1Modules] AS S
WHERE NOT EXISTS (
    SELECT 1
    FROM[UniversityDW].[dbo].[DW_Year1Modules] AS DWH
    WHERE DWH.ModuleCode = S.ModuleCode
	);

END

EXEC Insert_yr2_UniversityDW;

----Stored procedure for inserting year 3 data from stagingDB to Datawarehouse


CREATE PROCEDURE Insert_yr3_UniversityDW
AS
BEGIN
INSERT INTO [UniversityDW].[dbo].[DW_Year3Modules] (
	ModuleCode ,
	ModuleName ,
	Credits ,
	Category,
	LoadDate)
SELECT
   S.[ModuleCode],
   S.[ModuleName],
   S.[Credits],
   S.[Category],
   S.[DateInserted]
FROM
    [UniversityStagingDB].[dbo].[Year3Modules] AS S
WHERE NOT EXISTS (
    SELECT 1
    FROM[UniversityDW].[dbo].[DW_Year3Modules] AS DWH
    WHERE DWH.ModuleCode = S.ModuleCode
	);

END

EXEC Insert_yr3_UniversityDW;